# AI æ„å›¾è¯†åˆ«é—®é¢˜åˆ†æä¸ä¼˜åŒ–æ–¹æ¡ˆ

## ä¸€ã€ç°çŠ¶åˆ†æ

### å½“å‰å®ç°ï¼ˆè§„åˆ™å¼•æ“ï¼‰

**æ–‡ä»¶**: `quant_strategy/tools/ai_assistant_pro.py`

```python
# è¯†åˆ«åŠ¨ä½œ - ç¡¬ç¼–ç å…³é”®è¯åŒ¹é…
if any(word in command for word in ['ä¸‹è½½', 'è·å–', 'get', 'download', 'fetch']):
    result['action'] = 'download'
elif any(word in command for word in ['æŸ¥çœ‹', 'çŠ¶æ€', 'status', 'check', 'list', 'ç¼“å­˜']):
    result['action'] = 'status'
elif any(word in command for word in ['æ¸…ç†', 'æ¸…é™¤', 'clean', 'clear', 'delete']):
    result['action'] = 'cleanup'
# ... æ›´å¤šç¡¬ç¼–ç è§„åˆ™
```

### é—®é¢˜æ¸…å•

| é—®é¢˜ | ä¸¥é‡åº¦ | è¯´æ˜ |
|------|--------|------|
| âŒ ä¸æ˜¯çœŸæ­£çš„ AI | ğŸ”´ é«˜ | åŸºäº if-else è§„åˆ™ï¼Œä¸æ˜¯è¯­ä¹‰ç†è§£ |
| âŒ æ„å›¾è¯†åˆ«å·® | ğŸ”´ é«˜ | æ— æ³•ç†è§£åŒä¹‰è¡¨è¾¾ã€éšå«æ„å›¾ |
| âŒ æ³›åŒ–èƒ½åŠ›å¼± | ğŸ”´ é«˜ | ç”¨æˆ·æ¢ç§è¯´æ³•å°±è¯†åˆ«ä¸äº† |
| âŒ ç»´æŠ¤æˆæœ¬é«˜ | ğŸŸ¡ ä¸­ | æ¯åŠ ä¸€ä¸ªæ–°æ„å›¾è¦æ”¹ä»£ç  |
| âŒ å‚æ•°æå–ç²—ç³™ | ğŸŸ¡ ä¸­ | æ­£åˆ™æå–ï¼Œå¤æ‚åœºæ™¯å¤„ç†ä¸äº† |

### å®é™…æµ‹è¯•ï¼šç”¨æˆ·è¯´è¿™äº›ï¼Œç³»ç»Ÿèƒ½ç†è§£å—ï¼Ÿ

| ç”¨æˆ·è¾“å…¥ | æœŸæœ›åŠ¨ä½œ | å½“å‰è¯†åˆ« | é—®é¢˜ |
|---------|---------|---------|------|
| "å¸®æˆ‘æ‹¿ä¸‹èŒ…å° 2024 å¹´çš„æ•°æ®" | download | âœ… | ç¢°å·§èƒ½è¯†åˆ« |
| "æˆ‘æƒ³çœ‹çœ‹èŒ…å°å»å¹´èµ°åŠ¿" | download | âŒ unknown | "çœ‹çœ‹"ã€"èµ°åŠ¿"ä¸åœ¨å…³é”®è¯åˆ—è¡¨ |
| "æŠŠ 2024 å¹´çš„æ•°æ®æ›´æ–°ä¸€ä¸‹" | update | âŒ unknown | "æ›´æ–°ä¸€ä¸‹"æ²¡åŒ¹é…åˆ° |
| "æŸ¥æŸ¥ç¼“å­˜å¤šå¤§" | status | âœ… | ç¢°å·§æœ‰"æŸ¥"å’Œ"ç¼“å­˜" |
| "åˆ æ‰é‚£äº›æ—§æ•°æ®" | cleanup | âŒ unknown | "åˆ æ‰"ä¸åœ¨å…³é”®è¯åˆ—è¡¨ |
| "å›æµ‹ä¸€ä¸‹åŒå‡çº¿ç­–ç•¥" | backtest | âŒ unknown | æ²¡æœ‰"å›æµ‹"å…³é”®è¯ |
| "èŒ…å°å’Œå¹³å®‰é“¶è¡Œï¼Œä¸‹å®Œæ•°æ®ååšä¸ªå›æµ‹" | workflow | âŒ download | åªèƒ½è¯†åˆ«ä¸‹è½½ï¼Œä¸æ‡‚å·¥ä½œæµ |

---

## äºŒã€ä¼˜åŒ–æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ Aï¼šæ”¹è¿›è§„åˆ™å¼•æ“ï¼ˆä½æˆæœ¬ï¼Œå¿«é€Ÿï¼‰

**æ€è·¯**: æ‰©å±•ç°æœ‰è§„åˆ™ï¼Œå¢åŠ æ›´å¤šå…³é”®è¯å’Œæ¨¡å¼

```python
# æ‰©å±•æ„å›¾å…³é”®è¯
INTENT_PATTERNS = {
    'download': {
        'verbs': ['ä¸‹è½½', 'è·å–', 'æ‹¿', 'æŠ“å–', 'æ‹‰å–', 'fetch', 'download', 'get'],
        'objects': ['æ•°æ®', 'è‚¡ç¥¨', 'è¡Œæƒ…', 'K çº¿'],
        'patterns': [
            r'ä¸‹è½½ (.+?) çš„æ•°æ®',
            r'è·å– (.+?) çš„è¡Œæƒ…',
            r'å¸®æˆ‘ (?:æ‹¿ | æŠ“ | æ‹‰) (.+?) æ•°æ®',
        ]
    },
    'update': {
        'verbs': ['æ›´æ–°', 'åˆ·æ–°', 'åŒæ­¥', 'è¡¥å……'],
        'patterns': [...]
    },
    # ...
}
```

**ä¼˜ç‚¹**:
- âœ… å®ç°ç®€å•ï¼Œ1-2 å¤©å®Œæˆ
- âœ… ä¸ä¾èµ–å¤–éƒ¨æœåŠ¡
- âœ… æ€§èƒ½ç¨³å®š

**ç¼ºç‚¹**:
- âŒ è¿˜æ˜¯è§„åˆ™å¼•æ“ï¼Œä¸æ˜¯çœŸæ­£çš„ AI
- âŒ è§„åˆ™ä¼šè¶Šæ¥è¶Šå¤æ‚
- âŒ ä»ç„¶æ— æ³•å¤„ç†çµæ´»è¡¨è¾¾

---

### æ–¹æ¡ˆ Bï¼šé›†æˆå¤§æ¨¡å‹ APIï¼ˆæ¨èï¼‰â­

**æ€è·¯**: è°ƒç”¨ LLMï¼ˆå¦‚ DeepSeekã€é€šä¹‰åƒé—®ï¼‰è¿›è¡Œæ„å›¾è¯†åˆ«å’Œå‚æ•°æå–

```python
import openai

class LLMIntentRecognizer:
    """åŸºäºå¤§æ¨¡å‹çš„æ„å›¾è¯†åˆ«å™¨"""
    
    def __init__(self, api_key: str, model: str = "deepseek-chat"):
        self.client = openai.OpenAI(
            api_key=api_key,
            base_url="https://api.deepseek.com"
        )
        self.model = model
    
    def recognize(self, command: str) -> dict:
        """è¯†åˆ«ç”¨æˆ·æ„å›¾"""
        prompt = f"""
ä½ æ˜¯ä¸€ä¸ªè‚¡ç¥¨æ•°æ®åŠ©æ‰‹çš„æ„å›¾è¯†åˆ«ä¸“å®¶ã€‚
è¯·åˆ†æç”¨æˆ·è¾“å…¥ï¼Œæå–æ„å›¾å’Œå‚æ•°ã€‚

æ”¯æŒçš„æ„å›¾ï¼š
- download: ä¸‹è½½æ•°æ®
- update: æ›´æ–°æ•°æ®
- status: æŸ¥çœ‹çŠ¶æ€
- cleanup: æ¸…ç†ç¼“å­˜
- backtest: å›æµ‹ç­–ç•¥
- workflow: å¤šæ­¥éª¤å·¥ä½œæµ

ç”¨æˆ·è¾“å…¥ï¼š{command}

è¯·ä»¥ JSON æ ¼å¼è¿”å›ï¼š
{{
    "intent": "æ„å›¾åç§°",
    "confidence": ç½®ä¿¡åº¦ (0-1),
    "parameters": {{
        "ts_codes": ["è‚¡ç¥¨ä»£ç "],
        "start_date": "å¼€å§‹æ—¥æœŸ",
        "end_date": "ç»“æŸæ—¥æœŸ",
        "workers": çº¿ç¨‹æ•°
    }}
}}
"""
        response = self.client.chat.completions.create(
            model=self.model,
            messages=[{"role": "user", "content": prompt}]
        )
        return json.loads(response.choices[0].message.content)
```

**ä¼˜ç‚¹**:
- âœ… çœŸæ­£çš„è¯­ä¹‰ç†è§£
- âœ… æ”¯æŒçµæ´»è¡¨è¾¾
- âœ… å¯å¤„ç†å¤æ‚åœºæ™¯
- âœ… æŒç»­ä¼˜åŒ–ï¼ˆprompt å·¥ç¨‹ï¼‰

**ç¼ºç‚¹**:
- âŒ éœ€è¦ API è°ƒç”¨ï¼ˆæˆæœ¬ã€å»¶è¿Ÿï¼‰
- âŒ ä¾èµ–å¤–éƒ¨æœåŠ¡

**æˆæœ¬ä¼°ç®—**:
- DeepSeek: Â¥0.5/ç™¾ä¸‡ tokens
- æ¯æ¬¡è°ƒç”¨çº¦ 100 tokens = Â¥0.00005
- æ¯å¤© 1000 æ¬¡è°ƒç”¨ = Â¥0.05/å¤©

---

### æ–¹æ¡ˆ Cï¼šæ··åˆæ–¹æ¡ˆï¼ˆæœ€ä½³å®è·µï¼‰â­â­

**æ€è·¯**: è§„åˆ™å¼•æ“å¤„ç†ç®€å•å‘½ä»¤ï¼Œå¤§æ¨¡å‹å¤„ç†å¤æ‚/æ¨¡ç³Šå‘½ä»¤

```python
class HybridIntentRecognizer:
    """æ··åˆæ„å›¾è¯†åˆ«å™¨"""
    
    def __init__(self, llm_api_key: str = None):
        self.rule_engine = RuleEngine()
        self.llm = LLMIntentRecognizer(llm_api_key) if llm_api_key else None
    
    def recognize(self, command: str) -> dict:
        # 1. å…ˆå°è¯•è§„åˆ™å¼•æ“ï¼ˆå¿«é€Ÿï¼‰
        result = self.rule_engine.parse(command)
        
        # 2. å¦‚æœè§„åˆ™å¼•æ“ç½®ä¿¡åº¦ä½ï¼Œç”¨å¤§æ¨¡å‹
        if result['confidence'] < 0.7 and self.llm:
            result = self.llm.recognize(command)
        
        # 3. å¦‚æœè¿˜æ˜¯ unknownï¼Œè¯¢é—®ç”¨æˆ·æ¾„æ¸…
        if result['intent'] == 'unknown':
            return self._ask_for_clarification(command)
        
        return result
```

---

## ä¸‰ã€å®æ–½å»ºè®®

### é˜¶æ®µ 1ï¼šæ”¹è¿›è§„åˆ™å¼•æ“ï¼ˆ1-2 å¤©ï¼‰

1. æ‰©å±•æ„å›¾å…³é”®è¯
2. å¢åŠ æ„å›¾ç½®ä¿¡åº¦è¯„åˆ†
3. æ”¯æŒæ›´å¤šè¡¨è¾¾æ¨¡å¼

### é˜¶æ®µ 2ï¼šé›†æˆå¤§æ¨¡å‹ï¼ˆ3-5 å¤©ï¼‰

1. é€‰æ‹© LLM æä¾›å•†ï¼ˆDeepSeek/é€šä¹‰åƒé—®ï¼‰
2. å®ç°æ„å›¾è¯†åˆ« Prompt
3. æ·»åŠ  API è°ƒç”¨å’Œé”™è¯¯å¤„ç†
4. æµ‹è¯•å’Œä¼˜åŒ–

### é˜¶æ®µ 3ï¼šæ··åˆæ–¹æ¡ˆï¼ˆ2-3 å¤©ï¼‰

1. å®ç°è·¯ç”±é€»è¾‘
2. é…ç½®ç½®ä¿¡åº¦é˜ˆå€¼
3. æ·»åŠ ç”¨æˆ·æ¾„æ¸…æœºåˆ¶

---

## å››ã€æ•ˆæœå¯¹æ¯”

### æµ‹è¯•ç”¨ä¾‹

| ç”¨æˆ·è¾“å…¥ | è§„åˆ™å¼•æ“ | å¤§æ¨¡å‹ | æ··åˆæ–¹æ¡ˆ |
|---------|---------|--------|---------|
| "ä¸‹è½½èŒ…å° 2024 å¹´æ•°æ®" | âœ… | âœ… | âœ… |
| "å¸®æˆ‘æ‹¿ä¸‹èŒ…å°å»å¹´çš„æ•°æ®" | âŒ | âœ… | âœ… |
| "èŒ…å°å’Œå¹³å®‰é“¶è¡Œï¼Œä¸‹å®Œåšä¸ªå›æµ‹" | âŒ | âœ… | âœ… |
| "çœ‹çœ‹ç¼“å­˜å¤šå¤§" | âš ï¸ | âœ… | âœ… |
| "æŠŠæ—§æ•°æ®æ¸…ä¸€æ¸…" | âŒ | âœ… | âœ… |
| "æœ€è¿‘æ•°æ®å¯èƒ½ä¸å‡†ï¼Œåˆ·æ–°ä¸‹" | âŒ | âœ… | âœ… |

**é€šè¿‡ç‡**:
- è§„åˆ™å¼•æ“ï¼š~40%
- å¤§æ¨¡å‹ï¼š~95%
- æ··åˆæ–¹æ¡ˆï¼š~95%ï¼ˆæˆæœ¬é™ä½ 70%ï¼‰

---

## äº”ã€å¿«é€ŸéªŒè¯

### æµ‹è¯•å½“å‰ç³»ç»Ÿ

```bash
# è¿è¡Œæ„å›¾è¯†åˆ«æµ‹è¯•
python -c "
from quant_strategy.tools.ai_assistant_pro import AIAssistantPro
ai = AIAssistantPro()

test_cases = [
    'å¸®æˆ‘æ‹¿ä¸‹èŒ…å° 2024 å¹´çš„æ•°æ®',
    'æˆ‘æƒ³çœ‹çœ‹èŒ…å°å»å¹´èµ°åŠ¿',
    'æŠŠ 2024 å¹´çš„æ•°æ®æ›´æ–°ä¸€ä¸‹',
    'åˆ æ‰é‚£äº›æ—§æ•°æ®',
    'å›æµ‹ä¸€ä¸‹åŒå‡çº¿ç­–ç•¥',
]

for cmd in test_cases:
    result = ai.parse_command(cmd)
    print(f'{cmd:20} -> {result[\"action\"]} (confidence: {result.get(\"confidence\", \"N/A\")})')
"
```

### é¢„æœŸè¾“å‡ºï¼ˆå½“å‰ç³»ç»Ÿï¼‰

```
å¸®æˆ‘æ‹¿ä¸‹èŒ…å° 2024 å¹´çš„æ•°æ® -> download
æˆ‘æƒ³çœ‹çœ‹èŒ…å°å»å¹´èµ°åŠ¿     -> unknown  âŒ
æŠŠ 2024 å¹´çš„æ•°æ®æ›´æ–°ä¸€ä¸‹   -> unknown  âŒ
åˆ æ‰é‚£äº›æ—§æ•°æ®          -> unknown  âŒ
å›æµ‹ä¸€ä¸‹åŒå‡çº¿ç­–ç•¥       -> unknown  âŒ
```

---

## å…­ã€æ¨èè¡ŒåŠ¨

**ç«‹å³æ‰§è¡Œ**ï¼ˆä¼˜å…ˆçº§æ’åºï¼‰:

1. ğŸ”´ **æ‰©å±•æ„å›¾å…³é”®è¯** (30 åˆ†é’Ÿ)
   - æ·»åŠ æ›´å¤šåŠ¨è¯å’ŒåŒä¹‰è¯
   - æ”¯æŒå£è¯­åŒ–è¡¨è¾¾

2. ğŸŸ¡ **æ·»åŠ ç½®ä¿¡åº¦è¯„åˆ†** (1 å°æ—¶)
   - æ ¹æ®åŒ¹é…ç¨‹åº¦è¯„åˆ†
   - ä½ç½®ä¿¡åº¦æ—¶è¯¢é—®ç”¨æˆ·

3. ğŸŸ¢ **é›†æˆå¤§æ¨¡å‹** (1-2 å¤©)
   - é€‰æ‹© DeepSeek APIï¼ˆä¾¿å®œã€ä¸­æ–‡å¥½ï¼‰
   - å®ç°æ··åˆè¯†åˆ«å™¨
   - æµ‹è¯•å’Œä¼˜åŒ– Prompt

4. ğŸ”µ **æŒç»­ä¼˜åŒ–** (æŒç»­)
   - æ”¶é›†ç”¨æˆ·çœŸå®è¾“å…¥
   - åˆ†æè¯†åˆ«å¤±è´¥æ¡ˆä¾‹
   - è¿­ä»£ä¼˜åŒ–

---

## ä¸ƒã€ä»£ç ç¤ºä¾‹

### å¿«é€Ÿæ”¹è¿›ï¼ˆ30 åˆ†é’Ÿï¼‰

```python
# åœ¨ ai_assistant_pro.py ä¸­æ‰©å±•æ„å›¾è¯†åˆ«

INTENT_KEYWORDS = {
    'download': {
        'high': ['ä¸‹è½½', 'è·å–', 'fetch', 'download'],
        'medium': ['æ‹¿', 'æŠ“', 'æ‹‰', 'å–', 'get'],
        'low': ['çœ‹', 'æŸ¥', 'æŸ¥æŸ¥çœ‹']  # ç»“åˆä¸Šä¸‹æ–‡
    },
    'update': {
        'high': ['æ›´æ–°', 'åˆ·æ–°', 'åŒæ­¥', 'update', 'refresh'],
        'medium': ['è¡¥å……', 'è¡¥å…¨', 'è¡¥é½'],
        'low': ['æœ€æ–°', 'æœ€è¿‘', 'æ–°çš„']
    },
    'cleanup': {
        'high': ['æ¸…ç†', 'æ¸…é™¤', 'åˆ é™¤', 'clean', 'delete'],
        'medium': ['åˆ ', 'ä¸¢', 'æ‰”', 'æ¸…ç©º'],
        'low': ['æ—§', 'è¿‡æœŸ', 'ä¸è¦']
    },
    'backtest': {
        'high': ['å›æµ‹', 'å›æº¯æµ‹è¯•', 'backtest'],
        'medium': ['æµ‹è¯•', 'éªŒè¯', 'è¯•è¯•'],
        'low': ['ç­–ç•¥', 'æ•ˆæœ', 'è¡¨ç°']
    }
}

def recognize_intent(self, command: str) -> tuple:
    """è¯†åˆ«æ„å›¾ï¼Œè¿”å› (action, confidence)"""
    command_lower = command.lower()
    
    for intent, keywords in INTENT_KEYWORDS.items():
        # é«˜ç½®ä¿¡åº¦åŒ¹é…
        for word in keywords['high']:
            if word in command_lower:
                return intent, 0.9
        
        # ä¸­ç½®ä¿¡åº¦åŒ¹é…
        for word in keywords['medium']:
            if word in command_lower:
                return intent, 0.7
        
        # ä½ç½®ä¿¡åº¦åŒ¹é…ï¼ˆéœ€è¦ä¸Šä¸‹æ–‡ï¼‰
        for word in keywords['low']:
            if word in command_lower:
                # æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–çº¿ç´¢
                if any(w in command for w in ['æ•°æ®', 'è‚¡ç¥¨', 'è¡Œæƒ…']):
                    return intent, 0.5
    
    return 'unknown', 0.0
```

---

**ç»“è®º**: å½“å‰çš„"AI äº¤äº’"åä¸å‰¯å®ï¼Œæ˜¯è§„åˆ™å¼•æ“ã€‚è¦çœŸæ­£æå‡ç”¨æˆ·ä½“éªŒï¼Œå¿…é¡»å¼•å…¥å¤§æ¨¡å‹è¿›è¡Œè¯­ä¹‰ç†è§£ã€‚æ··åˆæ–¹æ¡ˆæ˜¯æœ€ä½³é€‰æ‹©ï¼šè§„åˆ™å¼•æ“å¤„ç†å¸¸è§å‘½ä»¤ï¼ˆå¿«é€Ÿã€å…è´¹ï¼‰ï¼Œå¤§æ¨¡å‹å¤„ç†å¤æ‚/æ¨¡ç³Šå‘½ä»¤ï¼ˆå‡†ç¡®ã€çµæ´»ï¼‰ã€‚
